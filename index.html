<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flipbook Katalog Cipanas</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap');
  
  /* --- Pengaturan Dasar dan Latar Belakang Website --- */
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    /* Latar belakang body dengan corak/desain */
    background: 
      radial-gradient(circle at top left, rgba(200, 220, 200, 0.2) 0%, transparent 20%),
      radial-gradient(circle at bottom right, rgba(200, 220, 200, 0.2) 0%, transparent 20%),
      url('Background_Website.jpg') no-repeat center center fixed; /* Gambar latar tetap */
    background-size: cover;
    font-family: 'Lora', serif;
    overflow: hidden;
    position: relative;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(4px);
    z-index: 0;
  }

  /* --- Kontainer utama flipbook responsif --- */
  .flipbook-container {
    position: relative;
    width: 70vw;
    height: 90vh;
    max-width: 850px; 
    max-height: 1200px;
    border-radius: 10px;
    overflow: hidden;
    /* Frame background */
    background-image: url('Frame1.jpg'); 
    background-size: cover; 
    background-repeat: no-repeat;
    background-position: center center;
    background-color: #E5F5E5; 
    box-shadow: 0 8px 18px rgba(0,0,0,0.4);
    perspective: 2500px; 
    z-index: 1;
  }

  .page {
    width: 100%;
    height: 100%;
    position: absolute;
    backface-visibility: hidden;
    transform-origin: left center;
    transition: transform 1.2s cubic-bezier(0.4, 0.2, 0.2, 1); 
    box-shadow: 0 0 15px rgba(0,0,0,0.15);
  }
  
  /* PENTING: Atur z-index agar halaman baru masuk dengan benar */
  .page:not(.active) { z-index: 1; }
  .page.active { transform: rotateY(0deg); z-index: 2; }


  .page img {
    width: 100%;
    height: 100%;
    object-fit: contain; 
  }

  /* Animasi flip - Durasi disesuaikan */
  .page.flip-next,
  .page.flip-prev {
    z-index: 3 !important; /* Pastikan halaman yang bergerak selalu di atas */
    animation-fill-mode: forwards;
  }

  .page.flip-next { animation: flipNext 1.2s forwards; }
  .page.flip-prev { animation: flipPrev 1.2s forwards; } 

  @keyframes flipNext {
    0% { transform: rotateY(0deg); opacity: 1; }
    100% { transform: rotateY(-180deg); opacity: 1; }
  }

  @keyframes flipPrev {
    0% { transform: rotateY(-180deg); opacity: 1; } /* Pastikan mulai dari terbalik */
    100% { transform: rotateY(0deg); opacity: 1; }
  }

  /* Tombol navigasi */
  .nav-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(198,166,100,0.95);
    color: #fff;
    border: none;
    padding: 14px 18px;
    font-size: 1.3em;
    cursor: pointer;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    transition: background 0.3s ease, transform 0.2s;
    z-index: 5;
  }

  .nav-button:hover {
    background: #A5844C;
    transform: translateY(-50%) scale(1.1);
  }

  /* Tombol diletakkan menyesuaikan lebar katalog */
  .prev { left: calc(50% - 43vw); }
  .next { right: calc(50% - 43vw); }

  .page-number {
    position: absolute;
    bottom: 10px;
    right: 15px;
    background: rgba(255,255,255,0.8);
    color: #333;
    font-size: 0.9em;
    padding: 4px 10px;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    z-index: 10;
  }

  /* --- Menu pencarian di luar katalog --- */
  .search-bar {
    position: fixed;
    top: 15px;
    right: 20px;
    background: rgba(255,255,255,0.9);
    padding: 6px 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    display: flex;
    gap: 6px;
    align-items: center;
    z-index: 999;
  }

  .search-bar input {
    width: 70px;
    padding: 5px 7px;
    font-size: 0.9em;
    border: 1px solid #aaa;
    border-radius: 4px;
    outline: none;
    text-align: center;
  }

  .search-bar button {
    padding: 5px 10px;
    background: #C6A664;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    transition: background 0.3s;
  }

  .search-bar button:hover { background: #A5844C; }

  .copyright {
    position: fixed;
    bottom: 8px;
    right: 10px;
    font-size: 0.8em;
    color: #333;
    background: rgba(255,255,255,0.7);
    padding: 4px 8px;
    border-radius: 5px;
    z-index: 10;
  }

  /* --- Responsif untuk HP --- */
  @media (max-width: 600px) {
    .flipbook-container {
      width: 95vw; 
      height: 90vh; 
    }

    .prev { left: calc(50% - 48vw); }
    .next { right: calc(50% - 48vw); }
  }
</style>
</head>
<body>

<div class="search-bar">
  <input type="number" id="pageInput" placeholder="Hal..." min="1">
  <button onclick="goToPage()">Cari</button>
</div>

<button class="nav-button prev" onclick="prevPage()">❮</button>
<button class="nav-button next" onclick="nextPage()">❯</button>

<div class="flipbook-container" id="flipbook-container">
  <div class="page-number" id="pageNumber">Hal 1 / 122</div>
</div>

<div class="copyright">
  © 2025 Katalog Seni Rupa Istana Kepresidenan Cipanas
</div>

<script>
  const container = document.getElementById('flipbook-container');
  const totalPages = 122; 
  const animationDuration = 1200; 
  let currentPage = 1;
  let isAnimating = false; // Tambahkan flag untuk mencegah klik ganda

  const pageNumber = document.getElementById('pageNumber');
  const pageInput = document.getElementById('pageInput');
  
  let currentImg = document.createElement('div');
  currentImg.className = 'page active';
  currentImg.innerHTML = `<img src="cipanas${currentPage}.jpg" alt="Halaman ${currentPage}">`;
  container.appendChild(currentImg);

  function updatePageNumber() {
    pageNumber.textContent = `Hal ${currentPage} / ${totalPages}`;
    pageInput.value = currentPage; 
  }

  function preloadImage(index) {
    if (index > 0 && index <= totalPages) {
      const img = new Image();
      img.src = `cipanas${index}.jpg`;
    }
  }

  preloadImage(currentPage + 1);

  function showPage(index) {
    if (index < 1 || index > totalPages || index === currentPage || isAnimating) return;
    
    isAnimating = true; // Kunci animasi

    const direction = index > currentPage ? 'next' : 'prev';

    const newPage = document.createElement('div');
    newPage.className = 'page';
    newPage.innerHTML = `<img src="cipanas${index}.jpg" alt="Halaman ${index}">`;
    
    // Perbaikan: Tambahkan halaman baru (newPage) ke DOM lebih dulu
    container.appendChild(newPage);
    
    // PENTING: Tentukan halaman yang akan bergerak
    let pageToAnimate = (direction === 'next') ? currentImg : newPage;

    // Tambahkan kelas animasi
    if (direction === 'next') {
        currentImg.classList.add('flip-next');
    } else {
        // Untuk prev, halaman baru harusnya dimulai dari terbalik
        newPage.classList.add('flip-prev'); 
    }

    // Gunakan event listener untuk deteksi akhir animasi (lebih akurat dari setTimeout)
    pageToAnimate.addEventListener('animationend', handleAnimationEnd, {once: true});

    function handleAnimationEnd() {
        currentImg.remove();
        
        // Bersihkan semua kelas transisi dari halaman baru
        newPage.classList.remove('flip-prev'); 
        newPage.classList.remove('flip-next');

        // Jadikan halaman baru sebagai halaman aktif
        newPage.classList.add('active'); 

        currentImg = newPage;
        currentPage = index;
        
        preloadImage(currentPage + 1);
        preloadImage(currentPage - 1); 
        updatePageNumber();

        isAnimating = false; // Buka kunci animasi
    }
    
    // Fallback: Jika animationend tidak terpicu (misal di beberapa browser/kondisi), gunakan timeout
    setTimeout(() => {
        if (isAnimating) {
            handleAnimationEnd(); // Panggil manual jika timeout habis
        }
    }, animationDuration + 50); // Tambahkan sedikit buffer waktu
  }

  function nextPage() {
    if (currentPage < totalPages) showPage(currentPage + 1);
  }

  function prevPage() {
    if (currentPage > 1) showPage(currentPage - 1);
  }

  function goToPage() {
    const page = parseInt(document.getElementById('pageInput').value);
    if (!isNaN(page) && page >= 1 && page <= totalPages) {
      // Tentukan arah berdasarkan lompatan halaman
      const direction = page > currentPage ? 'next' : 'prev';
      showPage(page, direction); // Gunakan showPage tanpa parameter direction lagi di sini
    } else {
      alert(`Masukkan nomor antara 1 dan ${totalPages}`);
      pageInput.value = currentPage;
    }
  }

  document.addEventListener('keydown', (e) => {
    if (document.activeElement !== pageInput && !isAnimating) {
        if (e.key === 'ArrowRight') {
            nextPage();
        } else if (e.key === 'ArrowLeft') {
            prevPage();
        }
    } else if (e.key === 'Enter') {
        goToPage();
    }
  });

  updatePageNumber();
</script>

</body>
</html>
